import*as e from"react";const t=({applications:t,isLoading:a,error:n})=>{const[s,l]=e.useState(null),i=e.useMemo((()=>s?"healthy"===s?t.filter((e=>{var t,a;return"Healthy"===(null===(a=null===(t=e.status)||void 0===t?void 0:t.health)||void 0===a?void 0:a.status)})):"progressing"===s?t.filter((e=>{var t,a;return"Progressing"===(null===(a=null===(t=e.status)||void 0===t?void 0:t.health)||void 0===a?void 0:a.status)})):"degraded"===s?t.filter((e=>{var t,a;return"Degraded"===(null===(a=null===(t=e.status)||void 0===t?void 0:t.health)||void 0===a?void 0:a.status)})):"outOfSync"===s?t.filter((e=>{var t,a;return"OutOfSync"===(null===(a=null===(t=e.status)||void 0===t?void 0:t.sync)||void 0===a?void 0:a.status)})):t:t),[t,s]);return a?e.createElement("div",{className:"application-set-extension__loading"},"Chargement des applications..."):n?e.createElement("div",{className:"application-set-extension__error"},"Erreur lors du chargement des applications: ",n):0===t.length?e.createElement("div",{className:"application-set-extension__empty"},"Aucune application trouvée pour cet ApplicationSet."):e.createElement("div",null,e.createElement("div",{className:"application-set-extension__filters"},e.createElement("button",{className:"application-set-extension__filter "+(s?"":"application-set-extension__filter--active"),onClick:()=>l(null)},"Tous"),e.createElement("button",{className:"application-set-extension__filter "+("healthy"===s?"application-set-extension__filter--active":""),onClick:()=>l("healthy")},"Healthy"),e.createElement("button",{className:"application-set-extension__filter "+("progressing"===s?"application-set-extension__filter--active":""),onClick:()=>l("progressing")},"Progressing"),e.createElement("button",{className:"application-set-extension__filter "+("degraded"===s?"application-set-extension__filter--active":""),onClick:()=>l("degraded")},"Degraded"),e.createElement("button",{className:"application-set-extension__filter "+("outOfSync"===s?"application-set-extension__filter--active":""),onClick:()=>l("outOfSync")},"Out of Sync")),e.createElement("table",{className:"application-set-extension__table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Nom"),e.createElement("th",null,"Namespace"),e.createElement("th",null,"Cluster"),e.createElement("th",null,"Sync Status"),e.createElement("th",null,"Health Status"),e.createElement("th",null,"Actions"))),e.createElement("tbody",null,i.map((t=>{var a,n,s,l,i,o,c,r,p,d;return e.createElement("tr",{key:t.metadata.name},e.createElement("td",null,e.createElement("a",{href:`/applications/${t.metadata.name}`,target:"_blank",rel:"noopener noreferrer"},t.metadata.name)),e.createElement("td",null,t.spec.destination.namespace),e.createElement("td",null,t.spec.destination.name||t.spec.destination.server),e.createElement("td",null,e.createElement("div",{className:"application-set-extension__sync application-set-extension__sync--"+("Synced"===(null===(n=null===(a=t.status)||void 0===a?void 0:a.sync)||void 0===n?void 0:n.status)?"synced":"OutOfSync"===(null===(l=null===(s=t.status)||void 0===s?void 0:s.sync)||void 0===l?void 0:l.status)?"out-of-sync":"unknown")},(null===(o=null===(i=t.status)||void 0===i?void 0:i.sync)||void 0===o?void 0:o.status)||"Unknown")),e.createElement("td",null,e.createElement("div",{className:`application-set-extension__health application-set-extension__health--${((null===(r=null===(c=t.status)||void 0===c?void 0:c.health)||void 0===r?void 0:r.status)||"unknown").toLowerCase()}`},(null===(d=null===(p=t.status)||void 0===p?void 0:p.health)||void 0===d?void 0:d.status)||"Unknown")),e.createElement("td",null,e.createElement("div",{className:"application-set-extension__actions"},e.createElement("button",{className:"application-set-extension__action-button",onClick:()=>window.open(`/applications/${t.metadata.name}?view=tree`,"_blank")},"Voir"),e.createElement("button",{className:"application-set-extension__action-button application-set-extension__action-button--primary",onClick:()=>window.open(`/applications/${t.metadata.name}?operation=sync`,"_blank")},"Sync"))))})))))},a=({total:t,healthy:a,degraded:n,progressing:s,unknown:l})=>{if(0===t)return null;const i=a/t*100,o=n/t*100,c=s/t*100,r=l/t*100;return e.createElement("div",{style:{display:"flex",height:"8px",width:"100%",borderRadius:"4px",overflow:"hidden",marginBottom:"1.5rem"}},a>0&&e.createElement("div",{style:{width:`${i}%`,backgroundColor:"#18BE94"}}),s>0&&e.createElement("div",{style:{width:`${c}%`,backgroundColor:"#3B73D0"}}),n>0&&e.createElement("div",{style:{width:`${o}%`,backgroundColor:"#E96D76"}}),l>0&&e.createElement("div",{style:{width:`${r}%`,backgroundColor:"#8D9BAE"}}))},n=({resource:n})=>{const{applications:s,stats:l,isLoading:i,error:o}=(t=>{const[a,n]=e.useState([]),[s,l]=e.useState(!0),[i,o]=e.useState(null),c=e.useMemo((()=>a.reduce(((e,t)=>{var a,n,s,l;const i=(null===(n=null===(a=t.status)||void 0===a?void 0:a.health)||void 0===n?void 0:n.status)||"Unknown";e[i]=(e[i]||0)+1;const o=(null===(l=null===(s=t.status)||void 0===s?void 0:s.sync)||void 0===l?void 0:l.status)||"Unknown";return"Synced"===o?e.Synced=(e.Synced||0)+1:"OutOfSync"===o&&(e.OutOfSync=(e.OutOfSync||0)+1),e.total+=1,e}),{total:0,Healthy:0,Progressing:0,Degraded:0,Suspended:0,Missing:0,Unknown:0,Synced:0,OutOfSync:0})),[a]);return e.useEffect((()=>{const e=async()=>{try{l(!0),o(null);const e=await fetch(`/api/v1/applications?selector=argocd.argoproj.io/application-set-name=${t}`);if(!e.ok)throw new Error(`Erreur lors de la récupération des applications: ${e.statusText}`);const a=await e.json();n(a.items||[])}catch(e){console.error("Error fetching applications:",e),o(e instanceof Error?e.message:"Une erreur inconnue est survenue")}finally{l(!1)}};e();const a=setInterval(e,3e4);return()=>clearInterval(a)}),[t]),{applications:a,stats:c,isLoading:s,error:i}})(n.metadata.name);return e.createElement("div",{className:"application-set-extension"},e.createElement("div",{className:"white-box"},e.createElement("div",{className:"white-box__details"},e.createElement("div",{className:"application-set-extension__header"},e.createElement("h3",{className:"application-set-extension__title"},"Applications générées par ",n.metadata.name)),!i&&!o&&e.createElement("div",{className:"application-set-extension__stats"},e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Total"),e.createElement("span",{className:"application-set-extension__stat-value"},l.total)),e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Healthy"),e.createElement("span",{className:"application-set-extension__stat-value application-set-extension__stat-value--healthy"},l.Healthy)),e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Progressing"),e.createElement("span",{className:"application-set-extension__stat-value application-set-extension__stat-value--progressing"},l.Progressing)),e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Degraded"),e.createElement("span",{className:"application-set-extension__stat-value application-set-extension__stat-value--degraded"},l.Degraded)),e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Unknown"),e.createElement("span",{className:"application-set-extension__stat-value application-set-extension__stat-value--unknown"},l.Unknown)),e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Synced"),e.createElement("span",{className:"application-set-extension__stat-value application-set-extension__stat-value--healthy"},l.Synced)),e.createElement("div",{className:"application-set-extension__stat"},e.createElement("span",{className:"application-set-extension__stat-label"},"Out of Sync"),e.createElement("span",{className:"application-set-extension__stat-value application-set-extension__stat-value--degraded"},l.OutOfSync))),e.createElement(a,{total:l.total,healthy:l.Healthy,degraded:l.Degraded,progressing:l.Progressing,unknown:l.Unknown}),e.createElement(t,{applications:s,isLoading:i,error:o}))))};window.extensionsAPI?(window.extensionsAPI.registerResourceExtension("argoproj.io","ApplicationSet","v1alpha1",{component:n}),console.log("ApplicationSet extension registered successfully")):console.error("Failed to register ApplicationSet extension: extensionsAPI not available");export{n as default};
